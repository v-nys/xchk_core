{% extends 'base.html' %}
{% load static %}
{% block content %}
<canvas id="springydemo" width="960" height="1000px"/>
{% endblock %}

{% block javascript %}
{{ block.super }}
<script src="{% static 'xchk_core/js/springy.js' %}"></script>
<script src="{% static 'xchk_core/js/springyui.js' %}"></script>
{{ graph|json_script:"graph" }}
<script>
$(window).on('load', function() {
  const data = JSON.parse(document.getElementById('graph').textContent);
  var graph = new Springy.Graph();
  var nodes = {}
  // dependency pair: object and a list of strings (node UID's)
  // object has title field and URL field
  // first make node objects for all dependents and their dependencies
  for (dependency_pair_idx in data) {
    var dependent = data[dependency_pair_idx][0]
    if (!(dependent.title in nodes)) {
	    nodes[dependent.title] = graph.newNode({ label : dependent.title, onclick : function() {window.location.href = 'http://www.google.be'}});
    }
    for (dependency_idx in data[dependency_pair_idx][1]) {
      var dependency = data[dependency_pair_idx][1][dependency_idx]
      if (!(dependency.title in nodes)) {
	      nodes[dependency.title] = graph.newNode({ label : dependency.title, onclick : function() {window.location.href = 'http://www.ubuntu.com'} });
      }
    }
  }
  for (dependency_pair_idx in data) {
    var dependent = data[dependency_pair_idx][0]
    for (dependency_idx in data[dependency_pair_idx][1]) {
      var dependency = data[dependency_pair_idx][1][dependency_idx]
      graph.newEdge(nodes[dependency.title],nodes[dependent.title]);
    }
  }
  jQuery(function(){
    var springy = window.springy = jQuery('#springydemo').springy({
      graph: graph,
    });
  });
}); 
</script>
{% endblock %}
